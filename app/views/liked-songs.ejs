<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" type="" href="/css/style.css">
  <link rel="stylesheet" type="" href="/css/playlist.css">
  <link rel="stylesheet" type="" href="/css/loading.css">
  <title>Liked Songs</title>
</head>

<body class="lava">
  <!-- Loading overlay -->
  <div id="loading-overlay" class="loading-overlay hidden">
    <div style="text-align: center;">
      <div class="loading-spinner"></div>
      <div class="loading-text">Loading...</div>
    </div>
  </div>

  <%- include("./components/header") %>

    <main class="flex">
      <div class="window flex" id="playlist-header">
        <img width="300px" src="/media/liked-songs.jpg" alt="Liked Songs">
        <div class="flex" id="playlist-info">
          <h1>Liked Songs</h1>
          <p>Your collection of favorite tracks</p>
          <div class="flex" id="playlist-meta">
            <span>
              <%= tracks.length %> tracks
            </span>
          </div>
        </div>
      </div>

      <div class="window flex" id="stats">
        <h2>Stats go here</h2>
      </div>

      <div class="window" id="tracks">
        <h2>Tracks</h2>
        <ul class="track-list">
          <% for (const item of tracks) { %>
            <% if (item.track) { %>
              <a target="_blank" href="https://open.spotify.com/track/<%= item.track.id %>">
                <li class="track-item">
                  <div class="track flex">
                    <% if (item.track.album && item.track.album.images && item.track.album.images.length> 0) { %>
                      <img width="64px" height="64px" src="<%= item.track.album.images[2].url %>"
                        alt="<%= item.track.name %>">
                      <% } else { %>
                        <img width="64px" height="64px" src="/media/missing.jpg" alt=":(">
                        <% } %>
                          <div class="track-info">
                            <h3>
                              <%= item.track.name %>
                            </h3>
                            <p>
                              <%= item.track.artists.map(a=> a.name).join(", ") %>
                            </p>
                            <% const trackGenres=genres[item.track.id]; if (trackGenres) { %>
                              <div class="genre-tags">
                                <% trackGenres.split(", ").slice(0, 3).forEach(genre=> { %>
                                  <span class="genre-tag">
                                    <%= genre %>
                                  </span>
                                  <% }); %>
                              </div>
                              <% } %>
                          </div>
                          <div class="track-album">
                            <p>
                              <%= item.track.album ? item.track.album.name : "Unknown Album" %>
                            </p>
                          </div>
                          <div class="track-duration">
                            <% const minutes=Math.floor((item.track.duration_ms || 0) / 60000); const
                              seconds=Math.floor(((item.track.duration_ms || 0) % 60000) / 1000); const
                              formatted=`${minutes}:${seconds.toString().padStart(2, '0' )}`; %>
                              <span>
                                <%= formatted %>
                              </span>
                          </div>
                  </div>
                </li>
              </a>
              <% } %>
                <% } %>
        </ul>
      </div>

    </main>

    <%- include("./components/footer") %>

    <script>
      // Hide loading overlay when page loads (handles back button navigation)
      window.addEventListener('pageshow', function(event) {
        document.getElementById('loading-overlay').classList.add('hidden');
      });
    </script>
</body>

</html>
