<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" type="" href="css/style.css">
  <link rel="stylesheet" type="" href="css/playlist.css">
  <title><%= playlist.name %></title>
</head>

<body class="lava">
  <%- include("./components/header") %>

    <main class="flex">
      <div class="window flex" id="playlist-header">
        <% if (playlist.images && playlist.images.length > 0 && playlist.images[0].url) { %>
          <img width="300px" src="<%= playlist.images[0].url %>" alt="<%= playlist.name %>">
          <% } else { %>
            <img width="300px" src="/media/missing.jpg" alt=":(">
            <% } %>
              <div class="flex" id="playlist-info">
                <h1>
                  <%= playlist.name %>
                </h1>
                <% if (playlist.description) { %>
                  <p>
                    <%= playlist.description %>
                  </p>
                  <% } %>
                    <div class="flex" id="playlist-meta">
                      <span>
                        <%= playlist.owner.display_name %>
                      </span>
                      <span>â€¢</span>
                      <span>
                        <%= tracks.length %> tracks
                      </span>
                    </div>
              </div>
      </div>

      <div class="window" id="tracks">
        <h2>Tracks</h2>
        <ul class="track-list">
          <% for (const item of tracks) { %>
            <% if (item.track) { %>
              <li class="track-item">
                <div class="track flex">
                  <% if (item.track.album && item.track.album.images && item.track.album.images.length > 0) { %>
                    <img width="64px" height="64px" src="<%= item.track.album.images[2].url %>" alt="<%= item.track.name %>">
                    <% } else { %>
                      <img width="64px" height="64px" src="/media/missing.jpg" alt=":(">
                      <% } %>
                        <div class="track-info">
                          <h3>
                            <%= item.track.name %>
                          </h3>
                          <p>
                            <%= item.track.artists.map(a => a.name).join(", ") %>
                          </p>
                        </div>
                        <div class="track-album">
                          <p>
                            <%= item.track.album ? item.track.album.name : "Unknown Album" %>
                          </p>
                        </div>
                        <div class="track-duration">
                          <% 
                            const minutes = Math.floor((item.track.duration_ms || 0) / 60000);
                            const seconds = Math.floor(((item.track.duration_ms || 0) % 60000) / 1000);
                            const formatted = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                          %>
                          <span><%= formatted %></span>
                        </div>
                </div>
              </li>
              <% } %>
                <% } %>
        </ul>
      </div>

    </main>

    <%- include("./components/footer") %>
</body>

</html>

